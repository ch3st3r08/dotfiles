- name: Creating necessary folders
  ansible.builtin.file:
    path: "{{item}}"
    state: directory
    mode: '0755'
    recurse: true
  loop:
    - "{{ [home ~ '/Sources'] }}"
    - "{{themes_path[1]}}"
    - "{{icons_path[1]}}"
  become: true
  when: not ansible_check_mode
  tags: main

- name: Utils | Installing utility cmd packages
  ansible.builtin.expect:
    command: paru -S --noprogressbar --noconfirm --needed {{item}}
    responses:
      password: "{{sudo_password}}"
  when: paru_exist is succeeded
  loop: "{{common_cmd_util.values() | flatten}}"
  become: false
  tags: main

- name: Utils | Installing utility GUI packages
  ansible.builtin.expect:
    command: paru -S --noprogressbar --noconfirm --needed {{item}}
    responses:
      password: "{{sudo_password}}"
  when: paru_exist is succeeded
  loop: "{{common_gui_util.values() | flatten}}"
  become: false
  tags: main

- name: Installing utility Font packages
  ansible.builtin.expect:
    command: paru -S --noprogressbar --noconfirm --needed {{item}}
    responses:
      password: "{{sudo_password}}"
  when: paru_exist is succeeded
  loop: "{{common_fonts.values() | flatten}}"
  become: false
  tags: main

  # tryin to decide where to move this tasks, in their own Misc Role perhaps??
- name: Copying Fastfetch
  ansible.builtin.command:
    cmd: stow -d {{stow_dir}} -t {{home}} --no-folding --dotfiles -S fastfetch util-scripts music
  changed_when: true

- name: Setting plymouth theme to arch-logo-new
  ansible.builtin.command:
    cmd: plymouth-set-default-theme -R arch-logo-new
  changed_when: true
  become: true

- name: Moving Arch grub theme to correct path
  block:
    - name: Checking existence of Grub's theme
      ansible.builtin.stat:
        path: /usr/share/grub/themes/arch-linux
      register: f_stat

    - name: Moving theme to boot mount
      ansible.builtin.copy:
        src: /usr/share/grub/themes/arch-linux
        dest: /boot/grub/themes/arch-linux
        mode: '0644'
      become: true
      when: f_stat.stat.exists
