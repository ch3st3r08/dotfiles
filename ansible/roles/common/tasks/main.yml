- name: Creating necessary folders
  ansible.builtin.file:
    path: "{{item}}"
    state: directory
    mode: '0755'
    recurse: true
  loop:
    - '{{home}}/Sources'
    - '{{themes_path}}'
    - '{{icons_path}}'

- name: Utils | Installing utility cmd packages
  community.general.pacman:
    name: "{{item}}"
    state: present
  with_items: "{{common_cmd_util}}"

- name: Utils | Installing utility GUI packages
  community.general.pacman:
    name: "{{item}}"
    state: present
  with_items: "{{common_gui_util}}"

- name: Installing utility Font packages
  community.general.pacman:
    name: "{{item}}"
    state: present
  with_items: "{{common_fonts}}"

- name: Test if paru is already installed
  import_tasks: "{{ playbook_dir }}/pre_tasks/check_paru.yml"
  when: paru_exist is not defined

- name: "Installing AUR packages"
  ansible.builtin.expect:
    command: paru -S --noprogressbar --noconfirm --needed {{item}}
    responses:
      password: "{{sudo_password}}"
  when: paru_exist is succeeded
  with_items:
    - distro-grub-themes-arch
    - lssecret-git
    - menulibre
    - plymouth-theme-arch-logo-new
    - ttf-ms-fonts
    - tty-clock
  become: false

- name: Copying Fastfetch, Zathura and MPD configuration
  ansible.builtin.command:
    cmd: stow -d {{root_dir}}/../ -t {{home}} --no-folding --dotfiles -S fastfetch pdf-reader util-scripts mpd music
  changed_when: true

- name: Creating necessary files for MPD
  ansible.builtin.file:
    path: "{{item.path}}"
    state: "{{item.state}}"
    mode: "{{item.mode}}"
  loop:
    - { path: "{{config_dir}}/mpd/playlists", state: "directory", mode: "0755" }
    - { path: "{{config_dir}}/mpd/db", state: "touch", mode: "0644" }
    - { path: "{{config_dir}}/mpd/stickers.sql", state: "touch", mode: "0644" }
    - { path: "{{config_dir}}/mpd/pid", state: "touch", mode: "0644" }
    - { path: "{{config_dir}}/mpd/state", state: "touch", mode: "0644" }

- name: Setting plymouth theme to arch-logo-new
  ansible.builtin.command:
    cmd: plymouth-set-default-theme -R arch-logo-new
  changed_when: true
  become: true

- name: Moving Arch grub theme to correct path
  block:
    - name: Checking existence
      ansible.builtin.stat:
        path: /usr/share/grub/themes/arch-linux
      register: f_stat

    - name: Moving
      ansible.builtin.copy:
        src: /usr/share/grub/themes/arch-linux
        dest: /boot/grub/themes/arch-linux
        mode: '0644'
      become: true
      when: f_stat.stat.exists

- name: "Themes"
  import_tasks: themes.yml
